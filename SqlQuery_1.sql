DECLARE @CurrentMigration [nvarchar](max)

IF object_id('[dbo].[__MigrationHistory]') IS NOT NULL
    SELECT @CurrentMigration =
        (SELECT TOP (1) 
        [Project1].[MigrationId] AS [MigrationId]
        FROM ( SELECT 
        [Extent1].[MigrationId] AS [MigrationId]
        FROM [dbo].[__MigrationHistory] AS [Extent1]
        WHERE [Extent1].[ContextKey] = N'FluentAPI.Migrations.Configuration'
        )  AS [Project1]
        ORDER BY [Project1].[MigrationId] DESC)

IF @CurrentMigration IS NULL
    SET @CurrentMigration = '0'

IF @CurrentMigration < '202005222037577_InitialModel'
BEGIN
    CREATE TABLE [dbo].[Genres] (
        [Id] [int] NOT NULL IDENTITY,
        [Name] [nvarchar](255) NOT NULL,
        CONSTRAINT [PK_dbo.Genres] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[Movies] (
        [Id] [int] NOT NULL IDENTITY,
        [Name] [nvarchar](255) NOT NULL,
        [ReleaseDate] [datetime],
        [GenreId] [int] NOT NULL,
        [Classification] [tinyint] NOT NULL,
        CONSTRAINT [PK_dbo.Movies] PRIMARY KEY ([Id])
    )
    CREATE INDEX [IX_GenreId] ON [dbo].[Movies]([GenreId])
    ALTER TABLE [dbo].[Movies] ADD CONSTRAINT [FK_dbo.Movies_dbo.Genres_GenreId] FOREIGN KEY ([GenreId]) REFERENCES [dbo].[Genres] ([Id]) ON DELETE CASCADE
    CREATE TABLE [dbo].[__MigrationHistory] (
        [MigrationId] [nvarchar](150) NOT NULL,
        [ContextKey] [nvarchar](300) NOT NULL,
        [Model] [varbinary](max) NOT NULL,
        [ProductVersion] [nvarchar](32) NOT NULL,
        CONSTRAINT [PK_dbo.__MigrationHistory] PRIMARY KEY ([MigrationId], [ContextKey])
    )
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'202005222037577_InitialModel', N'FluentAPI.Migrations.Configuration',  0x1F8B0800000000000400ED596D6FDB3610FE3E60FF41D0C721B5120705B6C06E913A7161AC4E82382DF6ADA0A5B3438CA234920A6C14FB65FBB09FB4BFB0A344BD9192ED187DD98022406093F7C6BBE78E77F43F7FFD3D7ABD8999F70442D2848FFDB3C1A9EF010F9388F2F5D8CFD4EAC5CFFEEB573FFE30BA8EE28DF7A1A43BD774C8C9E5D87F542ABD0802193E424CE420A6A14864B252833089031225C1F0F4F497E0EC2C0014E1A32CCF1BDD675CD118F22FF87592F010529511364F2260D2ACE3CE2297EADD9018644A4218FB53960157977733DFBB6494A0010B602BDF239C278A2834EFE2BD848512095F2F525C20EC619B02D2AD089360CCBEA8C90F3DC1E9509F20A8194B51612655123F53E0D9B9714960B31FE558BF72193AED1A9DABB6FAD4B9E3C6FE5BE0024F6E6BBA9830A1A91A4E1DE4A4275EB57052051DB1A1FF4EBC49C6542660CC215382B013EF2E5B321AFE0ADB87E477E0639E31D6B4072DC2BDD6022EDD892405A1B6F7B03256CE22DF0BDA7C81CD58B135788A23CCB83A1FFADE0D2A274B0655B81BC75DA844001E10045110DD11A540702D03728739DA2D5DFA7FA90DF18519E27B73B279077CAD1EC7FEF0E54BDF9BD20D44E58AB1E03DA79850C8A444061D165A5A6FC8135DE7065BFAE7C91305E97BF7C0F26DF948D302FD837CEBA309F35424F17DC24A8E62F9E303116B50687FE2EE2D924C849625A3A086D14E70E5820E03574EFA1D5CDF105C965684121009576872A95C7F7EA0F15ED61C39FB3DB45BC8841129E98A86A6F299F36B48DB5B47A78DC98AE3B2A6CC8CAEAC2933EAB0ACC9E246CED8879BC92923EBFA8E3A2499DA323E4356219622106C8BD82B74BDD9222CDA5E9E43BC04614EB1A00C3B07DFFB405035360F4E4C5AD46F131655B4C3DDB4773A56E8B28AFEDC7573E1D0E6E2A59449487377346B9389705BDD358FBC1DE1AE7168CADB1C3D4853F4190677ECFFE498DF2DAF2ABAB53C03B7B6BC33DFAE60B7FC0A7353817719163DC584C890442EEED113517B058B1E085D7508C3C64A62C029576E85A43CA42961FD565B2C0796556D5225DCDEB98214B8AE88FDBE3F446B557B5CD59506CB4BFB9C320A1AE871EF3BE451C85101D4245B4AAF967A0B36AA2369B10F35792B4D7DB631A3452F40358F85177C5D42DA987120D7662FFB0387DD40D8626F9CD7925196C4064547C5B45DBF3BA32A636B3B9DE0EDCEA18684D251762AB48FD45196AB30D61346508C18E52812F4CC22A3394953AC8C8DD9C4AC788B623099BC583CBF758F0B1941283B3AF8CADA4A13F618640DD62EAA464BA7544885973759127D834CA2D821EB006D0FA24A852D5CBAE12A715692EBCFADFC28078A8EAC363C533C50AC0B42DE3FD93176F9F2999030223A7AB549C2B298F717A67EEEA2FB6AF2172BAE84516019EE5420C72D4EBD6E3BF9A010989C392E0445FE3F3F043D7CDF3A047D125ACD6C53506BE37079D52DD394D57BF5F4CBB19BBDA6387BEF2B03CEA98B3649A5BDAA8F561D1C999AB4FFE1C629520589EFA1BB9E68A40BD4622B15C4034D3058FCC1268CE2796B8239E1740552153DAB3F3C3D1B5A8F40FF9D079940CA881DF22AF3D56759AA5DBA775A7DE620D71C5FF91311E12311EE00BB53E8331F1CBEFBAD5768C7541FE167954FF5B5ACE2C5E059537EEE03A7CF9D61C3BD19FB9F729E0B6FF6DB47C376E2DD0ACCDB0BEFD4FBF333BD0DE058B8CDAD380A4BC74D88A61DFEAA439CD50B1F33921E3507F6B56B5F66F4FB9F4C7B6E7F7DC020D73FC715171F26E532C1B81620EE19693A67BCFE11AF4B72F7B8F505C7BFD6E91BBDFCDE81CF9D12BFCC88E7B62C8898C62F52885549D7B508FDFB1487B085958A66C657498959CBA292C47EC70745B01E934BA1E88A840AB743C052A79F7CCD73D775BC8468C66F3395660A8F0CF192B59E9035F477E9CFE7D8B6CDA3DB347FFFFC1C474033A9BE526EF99B8C369EF5A61DA5B84784CE297391EA582A7DA1AEB795A49B841F28C8B8AF2A050F10A70C85C95BBE204F708C6DEF25BC833509B765E7D92F647F20DA6E1F5D51B21624964646CD8F5F11C351BC79F52F635F36B1981D0000 , N'6.4.4')
END

